/*
 * This script is used for Novalnet plugin admin management process
 *
 * @author      Novalnet
 * @copyright   Copyright (c) Novalnet
 * @license     https://www.novalnet.de/payment-plugins/kostenlos/lizenz
 *
*/
function fillMerchantConfiguration(){transactionRequestHandler({nn_public_key:jQuery("input[name=novalnet_public_key]").val(),nn_private_key:jQuery("input[name=novalnet_private_key]").val(),nn_request_type:"autofill"})}function transactionRequestHandler(e){var n=jQuery("input[id=nn_post_url]").val();if("XDomainRequest"in window&&null!==window.XDomainRequest){var t=new XDomainRequest,a=jQuery.param(e);t.open("GET",n+a),t.onload=function(){autofillMerchantDetails(this.responseText)},t.onerror=function(){_result=!1},t.send()}else jQuery.ajax({url:n,type:"post",dataType:"html",data:e,global:!1,async:!1,success:function(e){autofillMerchantDetails(e)}})}function autofillMerchantDetails(e){var n=jQuery.parseJSON(e);if("SUCCESS"!=n.result.status)return jQuery('input[name="novalnet_public_key"],input[name="novalnet_private_key"]').val(""),jQuery(".content-header").prepend('<div class="alert alert-danger align-items-center"><i class="fal fa-info-circle mr-2"></i>'+n.result.status_text+"</div>"),jQuery("#novalnet_tariffid").val(""),!1;var t=Object.keys(n.merchant.tariff),a=jQuery("#novalnet_tariffid").val();try{var r=decodeURIComponent(escape("Auswählen"))}catch(e){r="Auswählen"}jQuery("#novalnet_tariffid").replaceWith('<select id="novalnet_tariffid" class="form-control combo" name="novalnet_tariffid"><option value="" disabled>'+r+"</option></select>"),jQuery("#novalnet_tariffid").find("option").remove();for(var o=0;o<t.length;o++)void 0!==t[o]&&jQuery("#novalnet_tariffid").append(jQuery("<option>",{value:jQuery.trim(t[o])+"-"+jQuery.trim(n.merchant.tariff[t[o]].type),text:jQuery.trim(n.merchant.tariff[t[o]].name)})),a==jQuery.trim(t[o])+"-"+jQuery.trim(n.merchant.tariff[t[o]].type)&&jQuery("#novalnet_tariffid").val(jQuery.trim(t[o])+"-"+jQuery.trim(n.merchant.tariff[t[o]].type))}function configureWebhookUrlAdminPortal(){var e={nn_public_key:jQuery("input[name=novalnet_public_key]").val(),nn_private_key:jQuery("input[name=novalnet_private_key]").val(),nn_webhook_url:jQuery("input[name=novalnet_webhook_url]").val(),nn_request_type:"configureWebhook"};webhookRequestParams=e;var n=jQuery("input[id=nn_post_url]").val();if("XDomainRequest"in window&&null!==window.XDomainRequest){var t=new XDomainRequest,a=jQuery.param(webhookRequestParams);t.open("GET",n+a),t.onload=function(){updateWebhookStatus(result)},t.onerror=function(){_result=!1},t.send()}else jQuery.ajax({url:n,type:"post",dataType:"html",data:webhookRequestParams,global:!1,async:!1,success:function(e){updateWebhookStatus(e)}})}function updateWebhookStatus(e){var n=jQuery.parseJSON(e);"SUCCESS"==n.result.status?alert(jQuery("input[name=nn_webhook_success]").val()):alert(n.result.status_text)}function senddata(e){orderDetailsHandler({order_no:e,nn_request_type:"orderDetails"})}function orderDetailsHandler(e){var n=jQuery("input[id=nn_post_url]").val();if("XDomainRequest"in window&&null!==window.XDomainRequest){var t=new XDomainRequest,a=jQuery.param(e);t.open("GET",n+a),t.onload=function(){jQuery(".nn_instalment_table").html(result),jQuery(".pagination-toolbar").hide()},t.onerror=function(){_result=!1},t.send()}else jQuery.ajax({url:n,type:"post",dataType:"html",data:e,global:!1,async:!1,success:function(e){jQuery(".nn_order_table").hide(),jQuery("#nn_transaction_info").html(e),jQuery("#nn_transaction_info").show(),jQuery(".pagination-toolbar").hide()}})}jQuery(document).ready((function(){var e=jQuery(".tab-content").children()[2];jQuery(e).find("[class*=subheading]").append('<i class="fa fa-chevron-circle-down nn_fa"></i>'),jQuery(e).find(".mb-3").hover((function(){jQuery(this).css("cursor","pointer")})),jQuery(".nn_fa").each((function(){jQuery(this).parent().addClass("nn-toggle-heading"),jQuery(this).parent().next().next().addClass("nn-toggle-content")})),jQuery(".nn-toggle-content").hide(),jQuery(".nn-toggle-heading").on("click",(function(){jQuery(this).next().next().toggle(700),jQuery(this).children("i").hasClass("fa-chevron-circle-down")?jQuery(this).children("i").addClass("fa-chevron-circle-up").removeClass("fa-chevron-circle-down"):jQuery(this).children("i").addClass("fa-chevron-circle-down").removeClass("fa-chevron-circle-up")})),null==jQuery("#novalnet_tariffid").val()&&jQuery("input[name=novalnet_tariffid]").attr("id","novalnet_tariffid"),""==jQuery("input[name=novalnet_public_key]").val()&&""==jQuery("input[name=novalnet_private_key]").val()&&0==jQuery(".nn_mandatory_alert").length&&jQuery(".content-header").prepend('<div class="alert alert-info nn_mandatory_alert"><i class="fal fa-info-circle"></i> '+jQuery("input[name=nn_lang_notification]").val()+"</div>"),null!=jQuery("input[name=novalnet_public_key]").val()&&""!=jQuery("input[name=novalnet_public_key]").val()?fillMerchantConfiguration():""==jQuery("input[name=novalnet_public_key]").val()&&jQuery("#novalnet_tariffid").val(""),jQuery("input[name=novalnet_public_key], input[name=novalnet_private_key]").on("change",(function(){""!=jQuery("input[name=novalnet_public_key]").val()&&""!=jQuery("input[name=novalnet_private_key]").val()?fillMerchantConfiguration():jQuery("#novalnet_tariffid").val("")})),jQuery("input[name=novalnet_webhook_url]").val(jQuery("#nn_webhook_url").val()),0==jQuery(".nn_webhook_button").length&&jQuery("#novalnet_webhook_url").parent().parent().after('<div class="row"><div class="ml-auto col-sm-6 col-xl-auto nn_webhook_button"><button name="nn_webhook_configure" id="nn_webhook_configure_button" class="btn btn-primary btn-block">'+jQuery("input[name=nn_webhook_configure]").val()+"</button></div></div>"),jQuery("#nn_webhook_configure_button").on("click",(function(){null!=jQuery("#novalnet_webhook_url").val()&&""!=jQuery("#novalnet_webhook_url").val()?(alert(jQuery("input[name=nn_webhook_change]").val()),configureWebhookUrlAdminPortal()):alert(jQuery("input[name=nn_webhook_invalid]").val())})),0==jQuery(".nn_webhook_notify").length&&jQuery("#novalnet_webhook_testmode").parent().parent().parent().parent().after('<div class="nn_webhook_notify">'+jQuery("#nn_webhook_notification").val()+"</div><br>"),jQuery(document).on("click",".nn_back_tab",(function(){jQuery(".nn_order_table").show(),jQuery("#nn_transaction_info").hide(),jQuery(".pagination-toolbar").show()}))}));