/*
 * Novalnet payment plugin
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Novalnet End User License Agreement
 *
 * DISCLAIMER
 *
 * If you wish to customize Novalnet payment extension for your needs,
 * please contact technic@novalnet.de for more information.
 *
 * @author      Novalnet AG
 * @copyright   Copyright (c) Novalnet
 * @license     https://www.novalnet.de/payment-plugins/kostenlos/lizenz
 *
 * Novalnet payment form processing script
*/
function removeSavedDetails(e){removeSavedDetailsRequestHandler({tid:e,nn_request_type:"remove",payment_name:jQuery("#nn_payment").val()})}function removeSavedDetailsRequestHandler(e){if(confirm(jQuery("#remove_saved_payment_detail").val())){var r=window.location.href;if("XDomainRequest"in window&&null!==window.XDomainRequest){var n=new XDomainRequest;e=jQuery.param(e);n.open("POST",r),n.onload=function(r){jQuery("#remove_"+e.token).remove(),alert(jQuery("#alert_text_payment_detail_removal").val()),location.reload()},n.onerror=function(){_result=!1},n.send(e)}else jQuery.ajax({url:r,type:"post",dataType:"html",data:e,success:function(e){jQuery("#novalnet_removal_error_alert").text(jQuery("#alert_text_payment_detail_removal").val()),jQuery("#novalnet_removal_error_alert").removeClass("d-none"),location.reload()}})}}function formatMoney(e,r,n,t=2){try{t=Math.abs(t),t=isNaN(t)?2:t;const a=e<0?"-":"";let o=parseInt(e=Math.abs(Number(e)||0).toFixed(t)).toString(),_=o.length>3?o.length%3:0;return a+(_?o.substr(0,_)+n:"")+o.substr(_).replace(/(\d{3})(?=\d)/g,"jQuery1"+n)+(t?r+Math.abs(e-o).toFixed(t).slice(2):"")}catch(e){console.log(e)}}jQuery(document).ready((function(){var e=jQuery("#nn_payment").val();if("novalnet_cc"==e){var r=""!=jQuery("#nn_cc_formfields").val()?jQuery.parseJSON(jQuery("#nn_cc_formfields").val()):null,n=""!=jQuery("#nn_cc_formdetails").val()?jQuery.parseJSON(jQuery("#nn_cc_formdetails").val()):null;NovalnetUtility.setClientKey(void 0!==n.client_key?n.client_key:"");var t={callback:{on_success:function(e){return jQuery("#nn_cc_panhash").val(e.hash),jQuery("#nn_cc_uniqueid").val(e.unique_id),jQuery("#nn_cc_3d_redirect").val(e.do_redirect),jQuery("#novalnet_cc_iframe").closest("form").submit(),!0},on_error:function(e){if(void 0!==e.error_message)return jQuery("#novalnet_cc_error_alert").text(e.error_message),jQuery("#novalnet_cc_error_alert").removeClass("d-none"),jQuery(".submit_once").removeAttr("disabled"),!1},on_show_overlay:function(e){jQuery("#novalnet_cc_iframe").addClass("novalnet_cc_overlay")},on_hide_overlay:function(e){jQuery("#novalnet_cc_iframe").removeClass("novalnet_cc_overlay")}},iframe:{id:"novalnet_cc_iframe",inline:void 0!==n.inline_form?n.inline_form:"0",style:{container:void 0!==r.novalnet_cc_form_css?r.novalnet_cc_form_css:"",input:void 0!==r.novalnet_cc_form_input?r.novalnet_cc_form_input:"",label:void 0!==r.novalnet_cc_form_label?r.novalnet_cc_form_label:""},text:{lang:void 0!==n.lang?n.lang:"en",error:void 0!==r.credit_card_error?r.credit_card_error:"",card_holder:{label:void 0!==r.credit_card_name?r.credit_card_name:"",place_holder:void 0!==r.credit_card_name_input?r.credit_card_name_input:"",error:void 0!==r.credit_card_error?r.credit_card_error:""},card_number:{label:void 0!==r.credit_card_number?r.credit_card_number:"",place_holder:void 0!==r.credit_card_number_input?r.credit_card_number_input:"",error:void 0!==r.credit_card_error?r.credit_card_error:""},expiry_date:{label:void 0!==r.credit_card_date?r.credit_card_date:"",place_holder:void 0!==r.credit_card_date_input?r.credit_card_date_input:"",error:void 0!==r.credit_card_error?r.credit_card_error:""},cvc:{label:void 0!==r.credit_card_cvc?r.credit_card_cvc:"",place_holder:void 0!==r.credit_card_cvc_input?r.credit_card_cvc_input:"",error:void 0!==r.credit_card_error?r.credit_card_error:""}}},customer:{first_name:void 0!==n.first_name?n.first_name:"",last_name:void 0!==n.last_name?n.last_name:n.first_name,email:void 0!==n.email?n.email:"",billing:{street:void 0!==n.street?n.street:"",city:void 0!==n.city?n.city:"",zip:void 0!==n.zip?n.zip:"",country_code:void 0!==n.country_code?n.country_code:""},shipping:{same_as_billing:void 0!==n.same_as_billing?n.same_as_billing:0}},transaction:{amount:void 0!==n.amount?n.amount:"",currency:void 0!==n.currency?n.currency:"",test_mode:void 0!==n.test_mode?n.test_mode:"0",enforce_3d:void 0!==n.enforce_3d?n.enforce_3d:"0"}}}if(jQuery("#nn_toggle_form").length<=0?jQuery("#nn_load_new_form").show():jQuery("#nn_load_new_form").hide(),jQuery("input[name='nn_radio_option']").length>0){var a=jQuery("input[name='nn_radio_option']:first").val();a?jQuery("#nn_customer_selected_token").val(a):jQuery("#nn_customer_selected_token").val("")}if(jQuery("input[name='nn_radio_option']").on("click",(function(){var e=jQuery(this).val();e?jQuery("#nn_customer_selected_token").val(e):jQuery("#nn_customer_selected_token").val(""),"nn_toggle_form"==jQuery(this).attr("id")?(jQuery("#nn_load_new_form").show(),jQuery("#nn_customer_selected_token").val("")):jQuery("#nn_load_new_form").hide()})),jQuery("input[name='nn_radio_option']:first").attr("checked","checked"),jQuery.inArray(e,["novalnet_sepa","novalnet_guaranteed_sepa","novalnet_instalment_sepa","novalnet_direct_debit_ach"])>-1){var o=jQuery("#nn_payment").closest("form").attr("id");jQuery("#"+o).submit((function(){return"none"!==jQuery("#nn_load_new_form").css("display")&&""==jQuery("#nn_sepa_account_no").val()?(jQuery("#novalnet_sepa_error_alert").text(jQuery("#nn_account_invalid").val()),jQuery("#novalnet_sepa_error_alert").show(),setTimeout((function(){jQuery("#novalnet_sepa_error_alert").hide()}),3e3),jQuery("#novalnet_sepa_error_alert").removeClass("d-none"),jQuery(".submit_once").removeAttr("disabled"),!1):"none"!==jQuery("#bic_div").css("display")&&""==jQuery("#nn_sepa_bic").val()?(jQuery("#novalnet_sepa_error_alert").text(jQuery("#nn_bic_invalid").val()),jQuery("#novalnet_sepa_error_alert").show(),setTimeout((function(){jQuery("#novalnet_sepa_error_alert").hide()}),3e3),jQuery("#novalnet_sepa_error_alert").removeClass("d-none"),jQuery(".submit_once").removeAttr("disabled"),!1):"none"===jQuery("#nn_load_new_form").css("display")||""!=jQuery("#nn_ach_account_holder").val()&&""!=jQuery("#nn_ach_account_no").val()&&""!=jQuery("#nn_ach_routing_no").val()?void 0:(""==jQuery("#nn_ach_account_holder").val()&&(jQuery("#novalnet_ach_holder_error_alert").text(jQuery("#nn_account_holder_invalid").val()),jQuery("#novalnet_ach_holder_error_alert").show(),setTimeout((function(){jQuery("#novalnet_ach_holder_error_alert").hide()}),3e3),jQuery("#novalnet_ach_holder_error_alert").removeClass("d-none"),jQuery(".submit_once").removeAttr("disabled")),""==jQuery("#nn_ach_account_no").val()&&(jQuery("#novalnet_ach_error_alert").text(jQuery("#nn_account_no_invalid").val()),jQuery("#novalnet_ach_error_alert").show(),setTimeout((function(){jQuery("#novalnet_ach_error_alert").hide()}),3e3),jQuery("#novalnet_ach_error_alert").removeClass("d-none"),jQuery(".submit_once").removeAttr("disabled")),""==jQuery("#nn_ach_routing_no").val()&&(jQuery("#novalnet_routing_error_alert").text(jQuery("#nn_routing_no_invalid").val()),jQuery("#novalnet_routing_error_alert").show(),setTimeout((function(){jQuery("#novalnet_routing_error_alert").hide()}),3e3),jQuery("#novalnet_routing_error_alert").removeClass("d-none"),jQuery(".submit_once").removeAttr("disabled")),!1)}))}if("novalnet_cc"==e){NovalnetUtility.createCreditCardForm(t);o=jQuery("#nn_payment").closest("form").attr("id");jQuery("#"+o).on("submit",(function(e){""==jQuery("#nn_cc_panhash").val()&&"none"!==jQuery("#nn_load_new_form").css("display")&&(NovalnetUtility.getPanHash(),e.preventDefault(),e.stopImmediatePropagation())}))}(jQuery("#nn_instalment_cycle").length>0&&jQuery("#nn_instalment_cycle").on("change",(function(){var e="";for(instalmentCycle=1;instalmentCycle<=jQuery(this).val();instalmentCycle++)if(instalmentCycle!=jQuery(this).val())e+="<tr><td>"+instalmentCycle+"</td><td>"+jQuery(this).find(":selected").attr("data-amount")+"</td></tr>";else{var r=jQuery("#nn_order_amount").val()-jQuery(this).find(":selected").attr("data-cycle-amount")*(jQuery(this).val()-1),n=jQuery("#novalnet_decimal_separator").val(),t=jQuery("#novalnet_thousand_separator").val();e+="<tr><td>"+instalmentCycle+"</td><td>"+formatMoney(r,n,t)+" "+jQuery("#nn_order_currency").val()+"</td></tr>"}jQuery("#nn_instalment_cycle_information").html(e)})).change(),""!=jQuery("#nn_company").val())&&(NovalnetUtility.isValidCompanyName(jQuery("#nn_company").val())?jQuery("#nn_show_dob").hide():jQuery("#nn_show_dob").show());if("none"!==jQuery("#nn_show_dob").css("display")&&jQuery.inArray(e,["novalnet_guaranteed_invoice","novalnet_guaranteed_sepa","novalnet_instalment_invoice","novalnet_instalment_sepa"])>-1){o=jQuery("#nn_payment").closest("form").attr("id");jQuery("#"+o).on("submit",(function(){var e=$("#nn_dob").val();if(!/^(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[0-2])\.(?!0000)\d{4}$/.test(e))return $("#novalnet_dob_error_alert").text($("#novalnet_dob_empty").val()),$("#novalnet_dob_error_alert").show(),setTimeout((function(){$("#novalnet_dob_error_alert").hide()}),3e3),$("#novalnet_dob_error_alert").removeClass("d-none"),$(".submit_once").removeAttr("disabled"),!1;var r=$("#nn_dob").val().split("."),n=new Date(r[2],r[1]-1,r[0]),t=new Date,a=t.getFullYear()-n.getFullYear(),o=t.getMonth()-n.getMonth();return(o<0||0===o&&t.getDate()<n.getDate())&&a--,a<18?($("#novalnet_dob_error_alert").text($("#novalnet_dob_invalid").val()),$("#novalnet_dob_error_alert").show(),setTimeout((function(){$("#novalnet_dob_error_alert").hide()}),3e3),$("#novalnet_dob_error_alert").removeClass("d-none"),$(".submit_once").removeAttr("disabled"),!1):""==jQuery("#nn_dob").val()?(jQuery("#novalnet_dob_error_alert").text(jQuery("#novalnet_dob_empty").val()),jQuery("#novalnet_dob_error_alert").show(),setTimeout((function(){jQuery("#novalnet_dob_error_alert").hide()}),3e3),jQuery("#novalnet_dob_error_alert").removeClass("d-none"),jQuery(".submit_once").removeAttr("disabled"),!1):void 0}))}jQuery(".nn_number").on("input",(function(){var e=jQuery(this).val().replace(/[^0-9]/g,"");jQuery(this).val(e)})),jQuery(".nn_holder").on("input",(function(){this.value=this.value.replace(/[^a-zA-Z\s]/g,"")}))}));