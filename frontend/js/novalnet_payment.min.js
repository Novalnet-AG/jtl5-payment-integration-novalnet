/*
 * This script load the payment form on the checkout
 *
 * @author      Novalnet
 * @copyright   Copyright (c) Novalnet
 * @license     https://www.novalnet.de/payment-plugins/kostenlos/lizenz
 *
*/
function setCookie(e,n){let t=new Date;t.setTime(t.getTime()+24*n*60*60*1e3),document.cookie="novalnet_selected_payment="+e+";expires="+t.toUTCString()+";path=/;SameSite=None;Secure"}function getCookie(){var e=document.cookie.match("(^|;) ?novalnet_selected_payment=([^;]*)(;|$)");return null!=e&&e.length?e[2]:null}jQuery(document).ready((function(){const e=new NovalnetPaymentForm;var n=jQuery("#nn_payment_id").val(),t=jQuery("#"+n).find("input").val();jQuery('input[type="radio"]').on("click",(function(){this.value!=t&&e.uncheckPayment()}));var s=null,o=!0;jQuery("#payment"+t).is(":checked")&&(o=!1,s=s||getCookie("novalnet_selected_payment"));const r={iframe:"#v13PaymentForm",initForm:{orderInformation:{lineItems:jQuery.parseJSON(jQuery("#nn_wallet_data").val())},setWalletPending:!0,uncheckPayments:o,showButton:!1}};s&&(r.checkPayment=s),jQuery("div[id*='_novalnet']").append(jQuery("#v13PaymentForm")),jQuery("#v13PaymentForm").on("load",(function(){jQuery("#payment"+t).is(":checked")&&jQuery(".submit_once").prop("disabled",!1)})),e.initiate(r),1==jQuery("div[id*='_novalnet']").closest("form").find(".submit_once").length&&jQuery("form.checkout-shipping-form").submit((function(t){if(0==jQuery("#nn_seamless_payment_form_response").length&&jQuery("#"+n+' input[name="Zahlungsart"]').is(":checked")){(jQuery("#nn_seamless_payment_form_response").length<=0||""==jQuery("#nn_seamless_payment_form_response").val())&&t.preventDefault();try{e.getPayment((e=>"ERROR"==e.result.status?(jQuery("#novalnet_payment_form_error_alert").text(e.result.message),jQuery("#novalnet_payment_form_error_alert").removeClass("d-none"),jQuery("html, body").animate({scrollTop:jQuery("#checkout").offset().top-160},500,(function(){jQuery("#checkout").prepend(jQuery("#novalnet_payment_form_error_alert"))})),jQuery(".submit_once").prop("disabled",!1),!1):(jQuery("form.checkout-shipping-form").append('<input type="hidden" name="nn_seamless_payment_form_response" id="nn_seamless_payment_form_response">'),jQuery("#nn_seamless_payment_form_response").val(btoa(unescape(encodeURIComponent(JSON.stringify(e))))),jQuery("form.checkout-shipping-form").submit(),!0)))}catch(t){return!0}}})),e.walletResponse({onProcessCompletion:async e=>"FAILURE"==e.result.status||"ERROR"==e.result.status?{status:"FAILURE",statusText:"failure"}:(0==jQuery("#nn_seamless_payment_form_response").length&&jQuery("form.checkout-shipping-form").append('<input type="hidden" name="nn_seamless_payment_form_response" id="nn_seamless_payment_form_response">'),jQuery("#nn_seamless_payment_form_response").val(btoa(JSON.stringify(e))),jQuery("div[id*='_novalnet']").closest("form").submit(),{status:"SUCCESS",statusText:"successful"})}),e.selectedPayment((e=>{setCookie(getCookie(),"-1"),setCookie(e.payment_details.type);var t=jQuery(".submit_once");jQuery("#"+n).find("input").prop("checked",!0),jQuery("#"+n).find('input[type="radio"]').trigger("change"),null==t||"GOOGLEPAY"!=e.payment_details.type&&"APPLEPAY"!=e.payment_details.type?jQuery(".submit_once").show():jQuery(".submit_once").hide()}))}));