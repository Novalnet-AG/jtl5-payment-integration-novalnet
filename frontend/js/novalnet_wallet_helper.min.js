/*
 * Novalnet payment plugin
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Novalnet End User License Agreement
 *
 * DISCLAIMER
 *
 * If you wish to customize Novalnet payment extension for your needs,
 * please contact technic@novalnet.de for more information.
 *
 * @author      Novalnet AG
 * @copyright   Copyright (c) Novalnet
 * @license     https://www.novalnet.de/payment-plugins/kostenlos/lizenz
 *
 * Novalnet wallet payment helper script
*/
var processedProduct={};function transactionInfo(e){return{amount:1==jQuery("#nn_cart_empty").val()?String(jQuery("#nn_order_amount").val()*jQuery("#quantity").val()):String(jQuery("#nn_order_amount").val()),currency:jQuery("#nn_currency").val(),paymentMethod:e,enforce3d:"on"==jQuery("#nn_enforce").val(),environment:"on"==configurationData[e].testmode?"SANDBOX":"PRODUCTION",setPendingPayment:!0}}function merchantInfo(e){return{countryCode:""!=jQuery("#nn_merchant_country_code").val()?jQuery("#nn_merchant_country_code").val():"DE",partnerId:jQuery("#nn_merchant_id").val()}}function orderInfo(e){return{merchantName:configurationData[e].seller_name,lineItems:1==jQuery("#nn_cart_empty").val()?[{label:jQuery("#nn_product_name").val()+"("+jQuery("#quantity").val()+" X "+jQuery("#nn_product_amount").val()+")",type:"LINE_ITEM",amount:String(jQuery("#nn_product_amount").val()*jQuery("#quantity").val())}]:jQuery.parseJSON(jQuery("#nn_final_article_details").val()),billing:{requiredFields:["postalAddress","phone","email"]},shipping:{requiredFields:["postalAddress","phone","email"],methodsUpdatedLater:!0}}}function buttonInfo(e){return{type:configurationData[e].button_type,locale:"eng"==jQuery("#nn_page_language").val()?"en-US":"de-DE",boxSizing:"fill",dimensions:{height:configurationData[e].button_height}}}function onprocessCompletion(e,n,t){if("SUCCESS"==e.result.status){e.paymentType=t;var a={name:"novalnetWalletResponse",params:[{novalnetWalletResponse:e}]};jQuery.ajax({url:jQuery("#nn_shop_url").val()+jQuery("#nn_io_path").val(),type:"post",dataType:"json",data:"io="+JSON.stringify(a),global:!1,async:!1,success:function(e){window.location.href=jQuery("#nn_shop_url").val()+"/novalnetwallet-checkout-"+jQuery("#nn_page_language").val()}})}else e.result.statusText&&alert(e.result.statusText)}function onShippingContactChange(e,n,t){e.paymentType=t;var a={name:"novalnetShippingAddressUpdate",params:[{novalnetWalletShippingAddress:e}]};jQuery.ajax({url:jQuery("#nn_shop_url").val()+jQuery("#nn_io_path").val(),type:"post",dataType:"json",data:"io="+JSON.stringify(a),global:!1,async:!1,success:function(e){var t=JSON.parse(e);let a={};0==t.shipping_address.length?a.methodsNotFound="There are no shipping options available. Please ensure that your address has been entered correctly, or contact us if you need any help.":t.shipping_address.length&&(a.amount=String(t.amount),a.lineItems=t.article_details,a.methods=t.shipping_address,a.defaultIdentifier=t.shipping_address[0].identifier),n(a)}})}function onShippingMethodChange(e,n,t){e.paymentType=t;var a={name:"novalnetShippingMethodUpdate",params:[{novalnetWalletShippingMethod:e}]};jQuery.ajax({url:jQuery("#nn_shop_url").val()+jQuery("#nn_io_path").val(),type:"post",dataType:"json",data:"io="+JSON.stringify(a),global:!1,async:!1,success:function(e){var t=JSON.parse(e),a={amount:String(t.amount),lineItems:t.article_details};n(a)}})}function onPaymentButtonClicked(e){if(1==jQuery("#nn_product_page").val()){var n=$("form.jtl-validate"),t="eng"==jQuery("#nn_page_language").val()?"demo":"gerdemo";if(n.find(":input").each((function(){this.checkValidity()||(event.preventDefault(),event.stopImmediatePropagation(),$(this).closest(".form-group").find("div.form-error-msg").remove(),$(this).closest(".form-group").addClass("has-error").append('<div class="form-error-msg w-100">'+t+"</div>"))})),(a=jQuery("#buy_form"))[0].checkValidity()&&1==jQuery("#nn_product_page").val()){var a,r=(a=jQuery("#buy_form")).serializeObject(),o=jQuery.evo.basket();o.pushedToBasket=function(e){},r.a=jQuery("#nn_product_id").val(),processedProduct.hasOwnProperty(r.a)||(processedProduct[r.a]=1,o.addToBasket(a,r))}}}function displayWalletButton(e){var n=NovalnetPayment().createPaymentObject();n.setPaymentIntent(paymentIntent),n.isPaymentMethodAvailable((function(t){t&&(0==jQuery("#nn_display_button").val()?("APPLEPAY"==e&&(n.addPaymentButton("#nn_product_display_applepay_button"),jQuery("apple-pay-button").css("width","100%","important")),"GOOGLEPAY"==e&&(n.addPaymentButton("#nn_product_display_googlepay_button"),$(".gpay-card-info-container").css("min-width",0,"important"))):("APPLEPAY"==e&&(n.addPaymentButton("#nn_cart_display_applepay_button"),jQuery("apple-pay-button").css("width","100%","important")),"GOOGLEPAY"==e&&n.addPaymentButton("#nn_cart_display_googlepay_button")))}))}