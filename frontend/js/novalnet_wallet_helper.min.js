/*
 * Novalnet payment plugin
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Novalnet End User License Agreement
 *
 * DISCLAIMER
 *
 * If you wish to customize Novalnet payment extension for your needs,
 * please contact technic@novalnet.de for more information.
 *
 * @author      Novalnet AG
 * @copyright   Copyright (c) Novalnet
 * @license     https://www.novalnet.de/payment-plugins/kostenlos/lizenz
 *
 * Novalnet wallet payment helper script
*/
var processedProduct={};function transactionInfo(n){return{amount:1==jQuery("#nn_cart_empty").val()?String(jQuery("#nn_order_amount").val()*jQuery("#quantity").val()):String(jQuery("#nn_order_amount").val()),currency:jQuery("#nn_currency").val(),paymentMethod:n,enforce3d:"on"==jQuery("#nn_enforce").val(),environment:"on"==configurationData[n].testmode?"SANDBOX":"PRODUCTION",setPendingPayment:!0}}function merchantInfo(n){return{countryCode:""!=jQuery("#nn_merchant_country_code").val()?jQuery("#nn_merchant_country_code").val():"DE",partnerId:jQuery("#nn_merchant_id").val()}}function orderInfo(n){return{merchantName:configurationData[n].seller_name,lineItems:1==jQuery("#nn_cart_empty").val()?[{label:jQuery("#nn_product_name").val()+"("+jQuery("#quantity").val()+" X "+jQuery("#nn_product_amount").val()+")",type:"LINE_ITEM",amount:String(jQuery("#nn_product_amount").val()*jQuery("#quantity").val())}]:jQuery.parseJSON(jQuery("#nn_final_article_details").val()),billing:{requiredFields:["postalAddress","phone","email"]},shipping:{requiredFields:["postalAddress","phone","email"],methodsUpdatedLater:!0}}}function buttonInfo(n){return{type:configurationData[n].button_type,locale:"eng"==jQuery("#nn_page_language").val()?"en-US":"de-DE",boxSizing:"fill",dimensions:{height:configurationData[n].button_height}}}function onprocessCompletion(n,e,t){if("SUCCESS"==n.result.status){n.paymentType=t;var a={name:"novalnetWalletResponse",params:[{novalnetWalletResponse:n}]};jQuery.ajax({url:jQuery("#nn_shop_url").val()+"/io.php",type:"post",dataType:"json",data:"io="+JSON.stringify(a),global:!1,async:!1,success:function(n){window.location.href=jQuery("#nn_shop_url").val()+"/novalnetwallet-checkout-"+jQuery("#nn_page_language").val()}})}else n.result.statusText&&alert(n.result.statusText)}function onShippingContactChange(n,e,t){n.paymentType=t;var a={name:"novalnetShippingAddressUpdate",params:[{novalnetWalletShippingAddress:n}]};jQuery.ajax({url:jQuery("#nn_shop_url").val()+"/io.php",type:"post",dataType:"json",data:"io="+JSON.stringify(a),global:!1,async:!1,success:function(n){var t=JSON.parse(n);let a={};0==t.shipping_address.length?a.methodsNotFound="There are no shipping options available. Please ensure that your address has been entered correctly, or contact us if you need any help.":t.shipping_address.length&&(a.amount=String(t.amount),a.lineItems=t.article_details,a.methods=t.shipping_address,a.defaultIdentifier=t.shipping_address[0].identifier),e(a)}})}function onShippingMethodChange(n,e,t){n.paymentType=t;var a={name:"novalnetShippingMethodUpdate",params:[{novalnetWalletShippingMethod:n}]};jQuery.ajax({url:jQuery("#nn_shop_url").val()+"/io.php",type:"post",dataType:"json",data:"io="+JSON.stringify(a),global:!1,async:!1,success:function(n){var t=JSON.parse(n),a={amount:String(t.amount),lineItems:t.article_details};e(a)}})}function onPaymentButtonClicked(n){if(1==jQuery("#nn_product_page").val()){var e=jQuery("#buy_form"),t=e.serializeObject(),a=jQuery.evo.basket();a.pushedToBasket=function(n){},t.a=jQuery("#nn_product_id").val(),processedProduct.hasOwnProperty(t.a)||(processedProduct[t.a]=1,a.addToBasket(e,t))}}function displayWalletButton(n){var e=NovalnetPayment().createPaymentObject();e.setPaymentIntent(paymentIntent),e.isPaymentMethodAvailable((function(t){t&&(0==jQuery("#nn_display_button").val()?("APPLEPAY"==n&&(e.addPaymentButton("#nn_product_display_applepay_button"),jQuery("apple-pay-button").css("width","100%","important")),"GOOGLEPAY"==n&&(e.addPaymentButton("#nn_product_display_googlepay_button"),$(".gpay-card-info-container").css("min-width",0,"important"))):("APPLEPAY"==n&&(e.addPaymentButton("#nn_cart_display_applepay_button"),jQuery("apple-pay-button").css("width","100%","important")),"GOOGLEPAY"==n&&e.addPaymentButton("#nn_cart_display_googlepay_button")))}))}